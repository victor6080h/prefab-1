<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f9fafb;
        }
        h1 {
            color: #1f2937;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #374151;
            margin-top: 0;
        }
        button {
            padding: 12px 24px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            transition: all 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .success { background: #10b981; color: white; }
        .info { background: #3b82f6; color: white; }
        .danger { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
        pre {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border-left: 4px solid #3b82f6;
        }
        img {
            max-width: 100%;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .status.success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .status.error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
        .status.info { background: #dbeafe; color: #1e40af; border: 1px solid #3b82f6; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì €ì¥/ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>

    <div class="section">
        <h2>ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
        <div id="currentStatus"></div>
    </div>

    <div class="section">
        <h2>1. í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì €ì¥</h2>
        <p>ìƒ˜í”Œ ë³€í˜•ë¥  ë°ì´í„°ì™€ ì´ë¯¸ì§€ë¥¼ LocalStorageì— ì €ì¥í•©ë‹ˆë‹¤.</p>
        <button class="success" onclick="saveTestStrainImage()">ğŸ’¾ í…ŒìŠ¤íŠ¸ ë³€í˜•ë¥  ì´ë¯¸ì§€ ì €ì¥</button>
        <div id="saveResult"></div>
    </div>

    <div class="section">
        <h2>2. ì €ì¥ëœ ë°ì´í„° í™•ì¸</h2>
        <p>LocalStorageì— ì €ì¥ëœ ë³€í˜•ë¥  ë°ì´í„° êµ¬ì¡°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <button class="info" onclick="checkStrainData()">ğŸ” LocalStorage ë°ì´í„° í™•ì¸</button>
        <div id="dataResult"></div>
    </div>

    <div class="section">
        <h2>3. ì´ë¯¸ì§€ í‘œì‹œ í…ŒìŠ¤íŠ¸</h2>
        <p>ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì „ì²´ ë³´ê³ ì„œì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.</p>
        <button class="info" onclick="displayStrainImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ í‘œì‹œ (ì „ì²´ ë³´ê³ ì„œ ë°©ì‹)</button>
        <div id="imageDisplay"></div>
    </div>

    <div class="section">
        <h2>4. ì „ì²´ ë³´ê³ ì„œ ë§í¬</h2>
        <button class="warning" onclick="window.open('print-report.html', '_blank')">ğŸ“„ ì „ì²´ ë³´ê³ ì„œ ì—´ê¸°</button>
        <button class="warning" onclick="window.open('page5.html', '_blank')">ğŸ“ ë³€í˜•ë¥  ë°ì´í„° í˜ì´ì§€ ì—´ê¸°</button>
    </div>

    <div class="section">
        <h2>5. ë°ì´í„° ê´€ë¦¬</h2>
        <button class="danger" onclick="clearStrainData()">ğŸ—‘ï¸ ë³€í˜•ë¥  ë°ì´í„° ì‚­ì œ</button>
        <button class="info" onclick="location.reload()">ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <script>
        const STORAGE_KEYS = {
            STRAIN_DATA: 'qms_strain_data',
            STRAIN_GRAPH_IMAGE: 'qms_strain_graph_image'
        };

        function getFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('ì €ì¥ì†Œ ì½ê¸° ì˜¤ë¥˜:', e);
                return null;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('ì €ì¥ì†Œ ì“°ê¸° ì˜¤ë¥˜:', e);
                alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
                return false;
            }
        }

        function saveTestStrainImage() {
            // í…ŒìŠ¤íŠ¸ìš© 10x10 ë¹¨ê°„ìƒ‰-íŒŒë€ìƒ‰ ê·¸ë¼ë°ì´ì…˜ PNG ì´ë¯¸ì§€
            const testImageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAUklEQVR42mNgQAL/GdAEMDEgC/j7+/9nYGD4z4AMMDAwMPz//x8ZYFNIUFxYWPg/AwMDMoeuEBkgKyQoxKaQoAKCCvEqxKsQrwK8CgkqBADdURcQj2hsuwAAAABJRU5ErkJggg==';
            
            const strainData = {
                maxStrain: 120,
                avgStrain: 75,
                eventCount: 2,
                strainReportImage: testImageData,
                timestamp: new Date().toISOString(),
                device: 'JANET PRO 3ì¶• ë””ì§€í„¸ ê°€ì†ë„ê³„ (ë³€í˜•ë¥ ê³„)'
            };
            
            console.log('ğŸ’¾ ë³€í˜•ë¥  ë°ì´í„° ì €ì¥ ì‹œë„:', strainData);
            const result = saveToStorage(STORAGE_KEYS.STRAIN_DATA, strainData);
            
            if (result) {
                document.getElementById('saveResult').innerHTML = `
                    <div class="status success">
                        <strong>âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì™„ë£Œ!</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>ìµœëŒ€ ë³€í˜•ë¥ : ${strainData.maxStrain}Î¼Îµ</li>
                            <li>í‰ê·  ë³€í˜•ë¥ : ${strainData.avgStrain}Î¼Îµ</li>
                            <li>ì´ë²¤íŠ¸ íšŸìˆ˜: ${strainData.eventCount}íšŒ</li>
                            <li>ì´ë¯¸ì§€ í¬ê¸°: ${testImageData.length} bytes</li>
                            <li>ì €ì¥ ì‹œê°„: ${strainData.timestamp}</li>
                        </ul>
                        <p><strong>ğŸ‰ ì´ì œ ì „ì²´ ë³´ê³ ì„œì—ì„œ ì´ ì´ë¯¸ì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</strong></p>
                    </div>
                `;
                updateCurrentStatus();
            } else {
                document.getElementById('saveResult').innerHTML = '<div class="status error"><strong>âŒ ì €ì¥ ì‹¤íŒ¨</strong></div>';
            }
        }

        function checkStrainData() {
            const data = getFromStorage(STORAGE_KEYS.STRAIN_DATA);
            
            if (data) {
                let html = '<div class="status success"><strong>âœ… ë°ì´í„° ì¡´ì¬</strong></div>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                if (data.strainReportImage) {
                    html += `
                        <div class="status success">
                            <strong>âœ… strainReportImage ì†ì„± ì¡´ì¬</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>ì´ë¯¸ì§€ ë°ì´í„° í¬ê¸°: ${data.strainReportImage.length.toLocaleString()} bytes</li>
                                <li>ì´ë¯¸ì§€ íƒ€ì…: ${data.strainReportImage.substring(0, 30)}...</li>
                                <li>Base64 ì¸ì½”ë”©: ${data.strainReportImage.includes('base64') ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}</li>
                            </ul>
                        </div>
                    `;
                } else {
                    html += '<div class="status error"><strong>âŒ strainReportImage ì†ì„± ì—†ìŒ</strong></div>';
                }
                
                document.getElementById('dataResult').innerHTML = html;
            } else {
                document.getElementById('dataResult').innerHTML = '<div class="status error"><strong>âŒ ì €ì¥ëœ ë°ì´í„° ì—†ìŒ</strong><p>ë¨¼ì € "í…ŒìŠ¤íŠ¸ ë³€í˜•ë¥  ì´ë¯¸ì§€ ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p></div>';
            }
        }

        function displayStrainImage() {
            const strainData = getFromStorage(STORAGE_KEYS.STRAIN_DATA);
            
            console.log('ğŸ–¼ï¸ ë³€í˜•ë¥  ë°ì´í„°:', strainData);
            
            if (strainData?.strainReportImage) {
                console.log('âœ… ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ë°œê²¬');
                document.getElementById('imageDisplay').innerHTML = `
                    <div class="status success">
                        <strong>âœ… ì´ë¯¸ì§€ í‘œì‹œ ì„±ê³µ</strong>
                        <p>ì•„ë˜ ì´ë¯¸ì§€ëŠ” ì „ì²´ ë³´ê³ ì„œ(print-report.html)ì—ì„œ í‘œì‹œë˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ë°©ì‹ì…ë‹ˆë‹¤.</p>
                    </div>
                    <img src="${strainData.strainReportImage}" alt="ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€" style="max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                    <div class="status info" style="margin-top: 10px;">
                        <strong>ğŸ’¡ ì „ì²´ ë³´ê³ ì„œ í™•ì¸</strong>
                        <p>ì´ì œ <a href="print-report.html" target="_blank" style="color: #3b82f6; text-decoration: underline;">ì „ì²´ ë³´ê³ ì„œ</a>ë¥¼ ì—´ì–´ì„œ "5. ë³€í˜•ë¥  ë°ì´í„°" ì„¹ì…˜ì˜ "ë“±ê¸‰ í‰ê°€ ë¦¬í¬íŠ¸" ì¹´ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                console.log('âŒ ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì—†ìŒ');
                document.getElementById('imageDisplay').innerHTML = `
                    <div class="status error">
                        <strong>âŒ ì´ë¯¸ì§€ ë°ì´í„° ì—†ìŒ</strong>
                        <p>ë¨¼ì € "í…ŒìŠ¤íŠ¸ ë³€í˜•ë¥  ì´ë¯¸ì§€ ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜, <a href="page5.html" target="_blank" style="color: #ef4444; text-decoration: underline;">ë³€í˜•ë¥  ë°ì´í„° í˜ì´ì§€</a>ì—ì„œ ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
                    </div>
                `;
            }
        }

        function clearStrainData() {
            if (confirm('ì •ë§ ë³€í˜•ë¥  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem(STORAGE_KEYS.STRAIN_DATA);
                alert('âœ… ë³€í˜•ë¥  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('saveResult').innerHTML = '';
                document.getElementById('dataResult').innerHTML = '';
                document.getElementById('imageDisplay').innerHTML = '';
                updateCurrentStatus();
            }
        }

        function updateCurrentStatus() {
            const data = getFromStorage(STORAGE_KEYS.STRAIN_DATA);
            
            if (data) {
                let statusHTML = '<div class="status success"><strong>âœ… ë³€í˜•ë¥  ë°ì´í„° ì €ì¥ë¨</strong></div>';
                statusHTML += '<ul style="margin: 10px 0; padding-left: 20px;">';
                statusHTML += `<li>ìµœëŒ€ ë³€í˜•ë¥ : ${data.maxStrain || 'ë¯¸ì„¤ì •'}Î¼Îµ</li>`;
                statusHTML += `<li>í‰ê·  ë³€í˜•ë¥ : ${data.avgStrain || 'ë¯¸ì„¤ì •'}Î¼Îµ</li>`;
                statusHTML += `<li>ì´ë²¤íŠ¸ íšŸìˆ˜: ${data.eventCount || '0'}íšŒ</li>`;
                statusHTML += `<li>ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€: ${data.strainReportImage ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}</li>`;
                if (data.timestamp) {
                    statusHTML += `<li>ì €ì¥ ì‹œê°„: ${new Date(data.timestamp).toLocaleString('ko-KR')}</li>`;
                }
                statusHTML += '</ul>';
                document.getElementById('currentStatus').innerHTML = statusHTML;
            } else {
                document.getElementById('currentStatus').innerHTML = '<div class="status info"><strong>â„¹ï¸ ì €ì¥ëœ ë³€í˜•ë¥  ë°ì´í„° ì—†ìŒ</strong><p>í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ë³€í˜•ë¥  ë°ì´í„° í˜ì´ì§€ì—ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p></div>';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            updateCurrentStatus();
            checkStrainData();
        });
    </script>
</body>
</html>
