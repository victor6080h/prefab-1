<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì²´ ë³´ê³ ì„œ ì¶œë ¥ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 4px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ì „ì²´ ë³´ê³ ì„œ ì¶œë ¥ í…ŒìŠ¤íŠ¸</h1>
        <p style="color: #6b7280;">
            ì´ í˜ì´ì§€ëŠ” ì „ì²´ ë³´ê³ ì„œì—ì„œ ëª¨ë“  ì´ë¯¸ì§€ì™€ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        </p>

        <div class="test-section">
            <h2>âœ… í…ŒìŠ¤íŠ¸ í•­ëª©</h2>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ LocalStorage ë°ì´í„° í™•ì¸</h2>
            <div id="storageData"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ëˆ„ë½ëœ í•­ëª©</h2>
            <div id="missingItems"></div>
        </div>

        <div style="margin-top: 2rem;">
            <a href="print-report.html" class="btn btn-primary">ğŸ“„ ì „ì²´ ë³´ê³ ì„œ ë³´ê¸°</a>
        </div>
    </div>

    <script src="assets/js/script.js"></script>
    <script>
        // í…ŒìŠ¤íŠ¸í•  í•­ëª© ëª©ë¡
        const testItems = [
            { key: 'ACCELERATION_DATA.accelReportImage', name: 'ê°€ì†ë„ ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€' },
            { key: 'ACCEL_GRAPH_IMAGE', name: 'ì „ì²´ ê°€ì†ë„ ê·¸ë˜í”„' },
            { key: 'TILT_DATA.tiltReportImage', name: 'ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€' },
            { key: 'TILT_GRAPH_IMAGE', name: 'ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„' },
            { key: 'STRAIN_DATA.strainReportImage', name: 'ë³€í˜•ë¥  ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€' },
            { key: 'STRAIN_GRAPH_IMAGE', name: 'ì „ì²´ ë³€í˜•ë¥  ê·¸ë˜í”„' },
            { key: 'FABRICATION_ERROR.measurements', name: 'ì¹˜ìˆ˜ ì¸¡ì • ë°ì´í„°' },
            { key: 'ERROR_CHART_IMAGE', name: 'ì œì‘ ì˜¤ì°¨ ë¶„í¬ ê·¸ë˜í”„' },
            { key: 'PHOTOS.errorPhoto1', name: 'ë¶€ì¬ ì‚¬ì§„ 1' },
            { key: 'PHOTOS.errorPhoto2', name: 'ë¶€ì¬ ì‚¬ì§„ 2' }
        ];

        function checkData() {
            const results = [];
            const missing = [];
            let storageHTML = '<table style="width: 100%; border-collapse: collapse;">';
            storageHTML += '<tr><th style="border: 1px solid #ddd; padding: 8px;">Storage Key</th><th style="border: 1px solid #ddd; padding: 8px;">ìƒíƒœ</th><th style="border: 1px solid #ddd; padding: 8px;">í¬ê¸°</th></tr>';

            testItems.forEach(item => {
                let value = null;
                let status = 'âŒ ì—†ìŒ';
                let size = '-';

                if (item.key.includes('.')) {
                    const [storageKey, subKey] = item.key.split('.');
                    const data = getFromStorage(STORAGE_KEYS[storageKey]);
                    if (data && data[subKey]) {
                        value = data[subKey];
                        if (Array.isArray(value)) {
                            status = `âœ… ìˆìŒ (${value.length}ê°œ)`;
                            size = JSON.stringify(value).length + ' bytes';
                        } else if (typeof value === 'string' && value.startsWith('data:image')) {
                            status = 'âœ… ìˆìŒ (ì´ë¯¸ì§€)';
                            size = (value.length / 1024).toFixed(1) + ' KB';
                        } else {
                            status = 'âœ… ìˆìŒ';
                            size = JSON.stringify(value).length + ' bytes';
                        }
                    } else {
                        missing.push(item.name);
                    }
                } else {
                    value = getFromStorage(STORAGE_KEYS[item.key]);
                    if (value) {
                        if (typeof value === 'string' && value.startsWith('data:image')) {
                            status = 'âœ… ìˆìŒ (ì´ë¯¸ì§€)';
                            size = (value.length / 1024).toFixed(1) + ' KB';
                        } else {
                            status = 'âœ… ìˆìŒ';
                            size = JSON.stringify(value).length + ' bytes';
                        }
                    } else {
                        missing.push(item.name);
                    }
                }

                results.push({ name: item.name, status, size });
                storageHTML += `<tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">${item.name}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">${status}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">${size}</td>
                </tr>`;
            });

            storageHTML += '</table>';

            // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
            const testResultsDiv = document.getElementById('testResults');
            let testHTML = '<ul>';
            results.forEach(result => {
                const className = result.status.includes('âœ…') ? 'success' : 'error';
                testHTML += `<li class="${className}"><strong>${result.name}:</strong> ${result.status} (${result.size})</li>`;
            });
            testHTML += '</ul>';
            testResultsDiv.innerHTML = testHTML;

            // Storage ë°ì´í„° í‘œì‹œ
            document.getElementById('storageData').innerHTML = storageHTML;

            // ëˆ„ë½ëœ í•­ëª© í‘œì‹œ
            const missingDiv = document.getElementById('missingItems');
            if (missing.length === 0) {
                missingDiv.innerHTML = '<p class="success">ğŸ‰ ëª¨ë“  í•­ëª©ì´ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤!</p>';
            } else {
                let missingHTML = '<p class="error">âš ï¸ ë‹¤ìŒ í•­ëª©ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:</p><ul>';
                missing.forEach(item => {
                    missingHTML += `<li class="error">${item}</li>`;
                });
                missingHTML += '</ul>';
                missingHTML += '<p class="info">ğŸ“ í•´ë‹¹ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”:</p>';
                missingHTML += '<ul>';
                if (missing.some(m => m.includes('ê°€ì†ë„'))) {
                    missingHTML += '<li><a href="page3.html">page3.html - ê°€ì†ë„ ë°ì´í„°</a></li>';
                }
                if (missing.some(m => m.includes('ê¸°ìš¸ê¸°'))) {
                    missingHTML += '<li><a href="page4.html">page4.html - ê¸°ìš¸ê¸° ë°ì´í„°</a></li>';
                }
                if (missing.some(m => m.includes('ë³€í˜•ë¥ '))) {
                    missingHTML += '<li><a href="page5.html">page5.html - ë³€í˜•ë¥  ë°ì´í„°</a></li>';
                }
                if (missing.some(m => m.includes('ì¹˜ìˆ˜') || m.includes('ì œì‘ ì˜¤ì°¨') || m.includes('ë¶€ì¬'))) {
                    missingHTML += '<li><a href="page6.html">page6.html - ë¶€ì¬ ì œì‘ ì˜¤ì°¨</a></li>';
                }
                missingHTML += '</ul>';
                missingDiv.innerHTML = missingHTML;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° í™•ì¸
        window.addEventListener('DOMContentLoaded', checkData);
    </script>
</body>
</html>
