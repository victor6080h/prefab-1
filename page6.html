<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ - ë¶€ì¬ ì œì‘ ì˜¤ì°¨</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="assets/js/script.js?v=20231123-2"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="header-title">Prefab í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p class="header-subtitle">ë¶€ì¬ ì œì‘ ì˜¤ì°¨ ì¸¡ì • ë° ë¹„êµ</p>
        </div>
    </header>

    <nav class="page-nav">
        <div class="container">
            <button onclick="window.location.href='index.html'" style="float: right; background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                ğŸ“‹ ë³´ê³ ì„œ ëª©ë¡
            </button>
            <ul>
                <li><a href="report.html">1. ì¢…í•© ìš”ì•½</a></li>
                <li><a href="page2.html">2. ìš´ì†¡ê²°ê³¼ ë¦¬í¬íŠ¸</a></li>
                <li><a href="page3.html">3. ê°€ì†ë„ ë°ì´í„°</a></li>
                <li><a href="page4.html">4. ê¸°ìš¸ê¸° ë°ì´í„°</a></li>
                <li><a href="page5.html">5. ë³€í˜•ë¥  ë°ì´í„°</a></li>
                <li><a href="page6.html" class="active">6. ë¶€ì¬ ì œì‘ ì˜¤ì°¨</a></li>
                <li><a href="dashboard.html">7. ì¢…í•© ëŒ€ì‹œë³´ë“œ</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div class="alert alert-info">
            <strong>ğŸ“ ì œì‘ ì˜¤ì°¨ ì¸¡ì • ì•ˆë‚´</strong>
            <p style="margin-top: 0.5rem;">
                Prefab ë¶€ì¬ì˜ ì„¤ê³„ì¹˜ì™€ ì‹¤ì œ ì¸¡ì •ì¹˜ë¥¼ ë¹„êµí•˜ì—¬ ì œì‘ ì˜¤ì°¨ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.
            </p>
            <div style="margin-top: 1rem; padding: 0.75rem; background-color: #f0f9ff; border-radius: 0.375rem;">
                <strong style="color: #1e40af;">KCS 24 11 25 : 2025 ì „ë‹¨ë©´ í”„ë¦¬ìºìŠ¤íŠ¸ ë°”ë‹¥íŒê³µ (êµ­í† êµí†µë¶€)</strong>
                <table style="width: 100%; margin-top: 0.5rem; font-size: 0.875rem;">
                    <tr style="background-color: transparent;">
                        <td style="padding: 0.25rem; border: none;"><strong>íŒ¨ë„ ê¸¸ì´:</strong></td>
                        <td style="padding: 0.25rem; border: none;">ì„¤ê³„ì¹˜ìˆ˜ì˜ Â±1% ë˜ëŠ” Â±30mm ì¤‘ ì‘ì€ ê°’</td>
                    </tr>
                    <tr style="background-color: transparent;">
                        <td style="padding: 0.25rem; border: none;"><strong>íŒ¨ë„ í­:</strong></td>
                        <td style="padding: 0.25rem; border: none;">ì„¤ê³„ì¹˜ìˆ˜ì˜ Â±1% ë˜ëŠ” Â±30mm ì¤‘ ì‘ì€ ê°’</td>
                    </tr>
                    <tr style="background-color: transparent;">
                        <td style="padding: 0.25rem; border: none;"><strong>íŒ¨ë„ ë‘ê»˜:</strong></td>
                        <td style="padding: 0.25rem; border: none;">+10mm ~ -5mm</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ë¶€ì¬ ì‚¬ì§„</h2>
            </div>
            <div class="card-body">
                <!-- ë¶€ì¬ ì¸¡ë©´ (ê°€ë¡œë¡œ ê¸¸ê²Œ) -->
                <div class="mb-3">
                    <h3 class="mb-2">ë¶€ì¬ ì¸¡ë©´</h3>
                    <label for="errorFileInput1" class="photo-upload" style="min-height: 150px; width: 100%; margin: 0; cursor: pointer;">
                        <input type="file" id="errorFileInput1" accept="image/*" capture="environment">
                        <img id="errorPhoto1" class="preview" style="display:none;">
                        <span class="placeholder">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜ ë˜ëŠ” ì—…ë¡œë“œ</span>
                    </label>
                </div>
                
                <!-- ë¶€ì¬ ì •ë©´ -->
                <div>
                    <h3 class="mb-2">ë¶€ì¬ ì •ë©´</h3>
                    <label for="errorFileInput2" class="photo-upload" style="min-height: 500px; margin: 0; cursor: pointer;">
                        <input type="file" id="errorFileInput2" accept="image/*" capture="environment">
                        <img id="errorPhoto2" class="preview" style="display:none;">
                        <span class="placeholder">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜ ë˜ëŠ” ì—…ë¡œë“œ</span>
                    </label>
                </div>
                
                <!-- ì‚¬ì§„ ë°ì´í„° í™•ì¸ ë²„íŠ¼ -->
                <div style="margin-top: 1rem;">
                    <button type="button" class="btn btn-secondary" onclick="checkPhotoData()">
                        ğŸ” ì‚¬ì§„ ë°ì´í„° í™•ì¸
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ì¹˜ìˆ˜ ì¸¡ì • ë°ì´í„°</h2>
                <p class="card-description">ê° í•­ëª©ì˜ ì„¤ê³„ì¹˜ì™€ ì¸¡ì •ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ë‹¨ìœ„: mm)</p>
            </div>
            <div class="card-body">
                <table>
                    <thead>
                        <tr>
                            <th>ì¸¡ì • í•­ëª©</th>
                            <th>ì„¤ê³„ì¹˜ (mm)</th>
                            <th>í—ˆìš©ì˜¤ì°¨</th>
                            <th>ì¸¡ì •ì¹˜ (mm)</th>
                            <th>ì˜¤ì°¨ (mm)</th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>íŒ¨ë„ ê¸¸ì´</td>
                            <td><input type="number" step="0.1" name="design1" class="error-input" value="3000" onchange="calculateError(1)"></td>
                            <td id="tolerance1" style="font-size: 0.875rem; color: #6b7280;">Â±30mm</td>
                            <td><input type="number" step="0.1" name="measured1" class="error-input" onchange="calculateError(1)"></td>
                            <td id="error1">-</td>
                            <td id="errorStatus1">-</td>
                        </tr>
                        <tr>
                            <td>íŒ¨ë„ í­</td>
                            <td><input type="number" step="0.1" name="design2" class="error-input" value="1200" onchange="calculateError(2)"></td>
                            <td id="tolerance2" style="font-size: 0.875rem; color: #6b7280;">Â±12mm</td>
                            <td><input type="number" step="0.1" name="measured2" class="error-input" onchange="calculateError(2)"></td>
                            <td id="error2">-</td>
                            <td id="errorStatus2">-</td>
                        </tr>
                        <tr>
                            <td>íŒ¨ë„ ë‘ê»˜</td>
                            <td><input type="number" step="0.1" name="design3" class="error-input" value="200" onchange="calculateError(3)"></td>
                            <td style="font-size: 0.875rem; color: #6b7280;">+10 ~ -5mm</td>
                            <td><input type="number" step="0.1" name="measured3" class="error-input" onchange="calculateError(3)"></td>
                            <td id="error3">-</td>
                            <td id="errorStatus3">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ì œì‘ ì˜¤ì°¨ ë¶„í¬ ê·¸ë˜í”„</h2>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 600px; width: 100%; max-width: 100%;">
                    <canvas id="errorChart" style="width: 100%; height: 100%;"></canvas>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="updateErrorChart()">ğŸ“ˆ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸</button>
                    <button class="btn btn-success" onclick="saveChartImage()">ğŸ’¾ ê·¸ë˜í”„ ì´ë¯¸ì§€ ì €ì¥</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ì¸¡ì • ê²°ê³¼ ìš”ì•½</h2>
            </div>
            <div class="card-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ìµœëŒ€ ì˜¤ì°¨</div>
                        <div class="stat-value" id="maxError">0.0 mm</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í‰ê·  ì˜¤ì°¨</div>
                        <div class="stat-value" id="avgError">0.0 mm</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì´ˆê³¼ í•­ëª©</div>
                        <div class="stat-value" id="errorExceedCount">0 ê°œ</div>
                    </div>
                    <div class="stat-card" id="errorFinalStatus">
                        <div class="stat-label">ì¢…í•© í‰ê°€</div>
                        <div class="stat-value">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>
                <div id="errorResultAlert" class="mt-3"></div>
            </div>
        </div>



        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ë¹„ê³  ë° íŠ¹ì´ì‚¬í•­</h2>
            </div>
            <div class="card-body">
                <textarea id="errorNotes" rows="5" 
                          placeholder="ì¸¡ì • ê³¼ì •ì—ì„œ ë°œê²¬ëœ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ë¹„ê³ ì‚¬í•­ì„ ê¸°ë¡í•˜ì„¸ìš”..."
                          style="width: 100%; resize: vertical; padding: 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm);"></textarea>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="page5.html" class="btn btn-secondary">â† ì´ì „: ë³€í˜•ë¥  ë°ì´í„°</a>
            <button class="btn btn-success" onclick="saveErrorData()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
            <a href="dashboard.html" class="btn btn-primary">ë‹¤ìŒ: ì¢…í•© ëŒ€ì‹œë³´ë“œ â†’</a>
        </div>
    </main>

    <script>
        // KCS ê¸°ì¤€ í—ˆìš©ì˜¤ì°¨ ê³„ì‚° í•¨ìˆ˜
        function getAllowableTolerance(index, design) {
            if (index === 1) {
                // íŒ¨ë„ ê¸¸ì´: Â±1% ë˜ëŠ” Â±30mm ì¤‘ ì‘ì€ ê°’
                const onePct = design * 0.01;
                const tolerance = Math.min(onePct, 30);
                // í—ˆìš©ì˜¤ì°¨ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.getElementById('tolerance1').textContent = `Â±${tolerance.toFixed(1)}mm`;
                return tolerance;
            } else if (index === 2) {
                // íŒ¨ë„ í­: Â±1% ë˜ëŠ” Â±30mm ì¤‘ ì‘ì€ ê°’
                const onePct = design * 0.01;
                const tolerance = Math.min(onePct, 30);
                // í—ˆìš©ì˜¤ì°¨ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.getElementById('tolerance2').textContent = `Â±${tolerance.toFixed(1)}mm`;
                return tolerance;
            } else if (index === 3) {
                // íŒ¨ë„ ë‘ê»˜: +10mm ~ -5mm (ë¹„ëŒ€ì¹­)
                return { upper: 10, lower: 5 };
            }
            return 5; // ê¸°ë³¸ê°’
        }
        
        // ì‚¬ì§„ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleErrorPhotoClick(inputId) {
            console.log('=== handleErrorPhotoClick í˜¸ì¶œ ===');
            console.log('inputId:', inputId);
            
            const input = document.getElementById(inputId);
            console.log('input ìš”ì†Œ:', input);
            
            if (input) {
                console.log('input.click() ì‹¤í–‰');
                input.click();
            } else {
                console.error('âŒ input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', inputId);
                alert('íŒŒì¼ ì…ë ¥ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì‚¬ì§„ ë°ì´í„° í™•ì¸ í•¨ìˆ˜
        function checkPhotoData() {
            console.log('=== ì‚¬ì§„ ë°ì´í„° í™•ì¸ ===');
            const photos = getFromStorage(STORAGE_KEYS.PHOTOS);
            
            if (!photos) {
                alert('ì €ì¥ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.');
                console.log('ì €ì¥ëœ ì‚¬ì§„ ì—†ìŒ');
                return;
            }
            
            console.log('ì „ì²´ ì €ì¥ëœ ì‚¬ì§„:', photos);
            console.log('ì €ì¥ëœ ì‚¬ì§„ ID ëª©ë¡:', Object.keys(photos));
            
            const photo1 = photos['errorPhoto1'];
            const photo2 = photos['errorPhoto2'];
            
            let message = 'ğŸ“¸ ì €ì¥ëœ ì‚¬ì§„ í™•ì¸:\n\n';
            
            if (photo1) {
                message += 'âœ“ ë¶€ì¬ ì¸¡ë©´: ì €ì¥ë¨ (' + (photo1.length / 1024).toFixed(0) + 'KB)\n';
                console.log('errorPhoto1 í¬ê¸°:', (photo1.length / 1024).toFixed(0), 'KB');
            } else {
                message += 'âœ— ë¶€ì¬ ì¸¡ë©´: ì €ì¥ ì•ˆë¨\n';
                console.log('errorPhoto1: ì—†ìŒ');
            }
            
            if (photo2) {
                message += 'âœ“ ë¶€ì¬ ì •ë©´: ì €ì¥ë¨ (' + (photo2.length / 1024).toFixed(0) + 'KB)\n';
                console.log('errorPhoto2 í¬ê¸°:', (photo2.length / 1024).toFixed(0), 'KB');
            } else {
                message += 'âœ— ë¶€ì¬ ì •ë©´: ì €ì¥ ì•ˆë¨\n';
                console.log('errorPhoto2: ì—†ìŒ');
            }
            
            alert(message);
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ë¶€ì¬ ì œì‘ ì˜¤ì°¨ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            loadErrorData();
            
            // ì €ì¥ëœ ì´ë¯¸ì§€ ë¡œë“œ (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
            console.log('ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘...');
            const savedPhotos = getFromStorage(STORAGE_KEYS.PHOTOS);
            console.log('ì €ì¥ëœ ì‚¬ì§„ ë°ì´í„°:', savedPhotos);
            
            setTimeout(function() {
                console.log('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤í–‰ (100ms í›„)');
                loadSavedImage('errorPhoto1');
                loadSavedImage('errorPhoto2');
                console.log('ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ');
            }, 100);

            document.querySelectorAll('.error-input').forEach(input => {
                input.addEventListener('change', autoSaveErrorData);
            });
            
            document.getElementById('errorNotes').addEventListener('change', autoSaveErrorData);
            
            // ì´ˆê¸° í—ˆìš©ì˜¤ì°¨ ê³„ì‚°
            calculateError(1);
            calculateError(2);
            
            // ì‚¬ì§„ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            console.log('ì‚¬ì§„ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘');
            document.getElementById('errorFileInput1').addEventListener('change', function() {
                console.log('errorFileInput1 change ì´ë²¤íŠ¸ ë°œìƒ');
                previewImage(this, 'errorPhoto1');
            });
            document.getElementById('errorFileInput2').addEventListener('change', function() {
                console.log('errorFileInput2 change ì´ë²¤íŠ¸ ë°œìƒ');
                previewImage(this, 'errorPhoto2');
            });
            console.log('ì‚¬ì§„ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        });

        function calculateError(index) {
            const designInput = document.querySelector(`input[name="design${index}"]`);
            const measuredInput = document.querySelector(`input[name="measured${index}"]`);
            
            const design = parseFloat(designInput.value) || 0;
            const measured = parseFloat(measuredInput.value) || 0;
            const error = measured - design;
            
            document.getElementById(`error${index}`).textContent = error.toFixed(1) + ' mm';
            
            // KCS ê¸°ì¤€ì— ë”°ë¥¸ í—ˆìš©ì˜¤ì°¨ ê°€ì ¸ì˜¤ê¸°
            const tolerance = getAllowableTolerance(index, design);
            
            const statusCell = document.getElementById(`errorStatus${index}`);
            let isExceeded = false;
            
            if (index === 3) {
                // íŒ¨ë„ ë‘ê»˜ëŠ” ë¹„ëŒ€ì¹­ í—ˆìš©ì˜¤ì°¨
                if (error > tolerance.upper || error < -tolerance.lower) {
                    isExceeded = true;
                }
            } else {
                // íŒ¨ë„ ê¸¸ì´/ì„¸ë¡œëŠ” ëŒ€ì¹­ í—ˆìš©ì˜¤ì°¨
                if (Math.abs(error) > tolerance) {
                    isExceeded = true;
                }
            }
            
            if (isExceeded) {
                statusCell.innerHTML = '<span class="badge badge-danger">ì´ˆê³¼</span>';
            } else if (measured > 0) {
                statusCell.innerHTML = '<span class="badge badge-success">ì •ìƒ</span>';
            } else {
                statusCell.textContent = '-';
            }
            
            updateErrorStatistics();
        }

        function updateErrorStatistics() {
            const errors = [];
            let exceedCount = 0;
            
            for (let i = 1; i <= 3; i++) {
                const errorText = document.getElementById(`error${i}`).textContent;
                if (errorText !== '-') {
                    errors.push(Math.abs(parseFloat(errorText)));
                    
                    // ê° í•­ëª©ì˜ ì´ˆê³¼ ì—¬ë¶€ í™•ì¸
                    const statusCell = document.getElementById(`errorStatus${i}`);
                    if (statusCell.innerHTML.includes('ì´ˆê³¼')) {
                        exceedCount++;
                    }
                }
            }
            
            if (errors.length === 0) return;
            
            const max = Math.max(...errors);
            const avg = errors.reduce((a, b) => a + b, 0) / errors.length;
            
            document.getElementById('maxError').textContent = max.toFixed(1) + ' mm';
            document.getElementById('avgError').textContent = avg.toFixed(1) + ' mm';
            document.getElementById('errorExceedCount').textContent = exceedCount + ' ê°œ';
            
            const finalStatus = document.getElementById('errorFinalStatus');
            const resultAlert = document.getElementById('errorResultAlert');
            
            if (exceedCount === 0) {
                finalStatus.className = 'stat-card success';
                finalStatus.querySelector('.stat-value').textContent = 'ì í•©';
                resultAlert.innerHTML = `
                    <div class="alert alert-success">
                        <strong>âœ… ì œì‘ ì˜¤ì°¨ ì í•© (KCS 24 11 25 : 2025)</strong><br>
                        ëª¨ë“  ì¸¡ì • í•­ëª©ì´ KCS ê¸°ì¤€ í—ˆìš© ë²”ìœ„ ì´ë‚´ì…ë‹ˆë‹¤.
                    </div>
                `;
            } else {
                finalStatus.className = 'stat-card danger';
                finalStatus.querySelector('.stat-value').textContent = 'ë¶€ì í•©';
                resultAlert.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ ì œì‘ ì˜¤ì°¨ ë¶€ì í•© (KCS 24 11 25 : 2025)</strong><br>
                        ${exceedCount}ê°œ í•­ëª©ì´ KCS ê¸°ì¤€ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì¬ê°€ê³µ ë˜ëŠ” ë³´ê°•ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updateErrorChart() {
            const labels = ['íŒ¨ë„ ê¸¸ì´', 'íŒ¨ë„ í­', 'íŒ¨ë„ ë‘ê»˜'];
            const values = [];
            const colors = [];
            const tolerances = []; // ê° í•­ëª©ë³„ í—ˆìš© ì˜¤ì°¨ ê¸°ì¤€
            
            for (let i = 1; i <= 3; i++) {
                const errorText = document.getElementById(`error${i}`).textContent;
                const statusCell = document.getElementById(`errorStatus${i}`);
                
                // ì„¤ê³„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                const design = parseFloat(document.querySelector(`input[name="design${i}"]`).value) || 0;
                const tolerance = getAllowableTolerance(i, design);
                
                // í—ˆìš© ì˜¤ì°¨ ê°’ ì €ì¥ (íŒ¨ë„ ë‘ê»˜ëŠ” ìƒí•œê°’ ì‚¬ìš©)
                if (i === 3) {
                    tolerances.push(tolerance.upper); // ë‘ê»˜ëŠ” +10mm
                } else {
                    tolerances.push(tolerance); // ê¸¸ì´/í­ì€ ëŒ€ì¹­
                }
                
                if (errorText !== '-') {
                    const value = Math.abs(parseFloat(errorText));
                    values.push(value);
                    // ìƒíƒœ ì…€ì˜ ì´ˆê³¼ ì—¬ë¶€ë¡œ ìƒ‰ìƒ ê²°ì •
                    colors.push(statusCell.innerHTML.includes('ì´ˆê³¼') ? '#ef4444' : '#3b82f6');
                } else {
                    values.push(0);
                    colors.push('#9ca3af');
                }
            }
            
            drawBarChart('errorChart', {
                labels: labels,
                values: values,
                colors: colors,
                title: 'í•­ëª©ë³„ ì œì‘ ì˜¤ì°¨',
                yLabel: 'ì˜¤ì°¨ (mm)',
                thresholds: {
                    values: tolerances, // ê° í•­ëª©ë³„ í—ˆìš© ì˜¤ì°¨ ê¸°ì¤€ì„ 
                    label: 'KCS í—ˆìš© ê¸°ì¤€',
                    color: '#f59e0b'  // ì£¼í™©ìƒ‰ ê¸°ì¤€ì„ 
                }
            });
            
            // ì°¨íŠ¸ë¥¼ ì´ë¯¸ì§€ë¡œ ì €ì¥
            setTimeout(() => {
                try {
                    const canvas = document.getElementById('errorChart');
                    if (canvas) {
                        const imageData = canvas.toDataURL('image/png');
                        saveToStorage(STORAGE_KEYS.ERROR_CHART_IMAGE, imageData);
                        console.log('âœ… ì œì‘ ì˜¤ì°¨ ë¶„í¬ ê·¸ë˜í”„ ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ');
                    }
                } catch (error) {
                    console.error('âŒ ì°¨íŠ¸ ì´ë¯¸ì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }, 100);
        }

        function saveErrorData() {
            const data = {
                measurements: [],
                notes: document.getElementById('errorNotes').value
            };
            
            for (let i = 1; i <= 3; i++) {
                const design = parseFloat(document.querySelector(`input[name="design${i}"]`).value) || 0;
                const measured = parseFloat(document.querySelector(`input[name="measured${i}"]`).value) || 0;
                const errorText = document.getElementById(`error${i}`).textContent;
                const error = errorText !== '-' ? parseFloat(errorText) : 0;
                
                data.measurements.push({ design, measured, error });
            }
            
            saveToStorage(STORAGE_KEYS.FABRICATION_ERROR, data);
            alert('ì œì‘ ì˜¤ì°¨ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function autoSaveErrorData() {
            const data = {
                measurements: [],
                notes: document.getElementById('errorNotes').value
            };
            
            for (let i = 1; i <= 3; i++) {
                const design = parseFloat(document.querySelector(`input[name="design${i}"]`).value) || 0;
                const measured = parseFloat(document.querySelector(`input[name="measured${i}"]`).value) || 0;
                const errorText = document.getElementById(`error${i}`).textContent;
                const error = errorText !== '-' ? parseFloat(errorText) : 0;
                
                data.measurements.push({ design, measured, error });
            }
            
            saveToStorage(STORAGE_KEYS.FABRICATION_ERROR, data);
        }

        function loadErrorData() {
            const data = getFromStorage(STORAGE_KEYS.FABRICATION_ERROR);
            if (!data) return;
            
            if (data.measurements) {
                data.measurements.forEach((m, i) => {
                    const index = i + 1;
                    const designInput = document.querySelector(`input[name="design${index}"]`);
                    const measuredInput = document.querySelector(`input[name="measured${index}"]`);
                    
                    if (designInput) designInput.value = m.design;
                    if (measuredInput) measuredInput.value = m.measured;
                    
                    calculateError(index);
                });
                
                updateErrorChart();
            }
            
            if (data.notes) {
                document.getElementById('errorNotes').value = data.notes;
            }
        }
    </script>
</body>
</html>
