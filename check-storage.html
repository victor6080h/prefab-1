<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage í™•ì¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .info {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .key {
            font-weight: bold;
            color: #333;
        }
        .size {
            color: #666;
            font-size: 0.9em;
        }
        .large {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .compressed {
            background: #d4edda;
            border-color: #28a745;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .danger {
            background: #dc3545;
        }
        .danger:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <h1>ğŸ” LocalStorage ë°ì´í„° í™•ì¸</h1>
    
    <div class="info">
        <h3>ì „ì²´ í†µê³„</h3>
        <div id="totalStats"></div>
    </div>
    
    <button onclick="loadData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    <button onclick="clearAll()" class="danger">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
    
    <h2>ğŸ“¦ ì €ì¥ëœ í•­ëª©</h2>
    <div id="items"></div>
    
    <script>
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
        
        function loadData() {
            const itemsDiv = document.getElementById('items');
            const statsDiv = document.getElementById('totalStats');
            itemsDiv.innerHTML = '';
            
            let totalSize = 0;
            let photoCount = 0;
            let totalPhotoSize = 0;
            let items = [];
            
            // LocalStorageì˜ ëª¨ë“  í•­ëª© ì¡°íšŒ
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                const size = new Blob([value]).size;
                totalSize += size;
                
                items.push({ key, value, size });
                
                // ì‚¬ì§„ ë°ì´í„° í™•ì¸
                if (key.includes('photo') || key.includes('Photo')) {
                    try {
                        const data = JSON.parse(value);
                        if (typeof data === 'object') {
                            // ê°ì²´ ë‚´ì˜ ëª¨ë“  ì‚¬ì§„ í™•ì¸
                            for (const photoKey in data) {
                                if (typeof data[photoKey] === 'string' && data[photoKey].startsWith('data:image')) {
                                    photoCount++;
                                    const photoSize = new Blob([data[photoKey]]).size;
                                    totalPhotoSize += photoSize;
                                    
                                    console.log(`ì‚¬ì§„ ë°œê²¬: ${key}.${photoKey} - ${formatBytes(photoSize)}`);
                                }
                            }
                        } else if (typeof data === 'string' && data.startsWith('data:image')) {
                            photoCount++;
                            totalPhotoSize += size;
                        }
                    } catch (e) {
                        // JSONì´ ì•„ë‹Œ ê²½ìš°, ì§ì ‘ ë¬¸ìì—´ í™•ì¸
                        if (value.startsWith('data:image')) {
                            photoCount++;
                            totalPhotoSize += size;
                        }
                    }
                }
            }
            
            // í†µê³„ í‘œì‹œ
            statsDiv.innerHTML = `
                <p><strong>ì „ì²´ í•­ëª©:</strong> ${localStorage.length}ê°œ</p>
                <p><strong>ì „ì²´ í¬ê¸°:</strong> ${formatBytes(totalSize)}</p>
                <p><strong>ì‚¬ì§„ ê°œìˆ˜:</strong> ${photoCount}ê°œ</p>
                <p><strong>ì‚¬ì§„ ì „ì²´ í¬ê¸°:</strong> ${formatBytes(totalPhotoSize)}</p>
                <p><strong>í‰ê·  ì‚¬ì§„ í¬ê¸°:</strong> ${photoCount > 0 ? formatBytes(totalPhotoSize / photoCount) : '0 B'}</p>
            `;
            
            // í¬ê¸°ìˆœìœ¼ë¡œ ì •ë ¬
            items.sort((a, b) => b.size - a.size);
            
            // í•­ëª© í‘œì‹œ
            items.forEach(item => {
                const div = document.createElement('div');
                const isLarge = item.size > 200 * 1024; // 200KB ì´ìƒ
                const isCompressed = item.size < 120 * 1024 && item.value.startsWith('data:image'); // 120KB ì´í•˜ ì´ë¯¸ì§€
                
                div.className = 'item ' + (isLarge ? 'large' : isCompressed ? 'compressed' : '');
                
                let preview = '';
                if (item.value.startsWith('data:image')) {
                    preview = `<img src="${item.value}" style="max-width: 200px; max-height: 150px; margin: 10px 0; display: block;">`;
                }
                
                const valuePreview = item.value.length > 100 ? item.value.substring(0, 100) + '...' : item.value;
                
                div.innerHTML = `
                    <div class="key">${item.key}</div>
                    <div class="size">í¬ê¸°: ${formatBytes(item.size)} ${isLarge ? 'âš ï¸ í¼' : isCompressed ? 'âœ… ì••ì¶•ë¨' : ''}</div>
                    ${preview}
                    ${!item.value.startsWith('data:image') ? `<div style="color: #666; font-size: 0.85em; margin-top: 5px;">${valuePreview}</div>` : ''}
                    <button onclick="deleteItem('${item.key}')" style="background: #dc3545; padding: 5px 10px; font-size: 12px; margin-top: 5px;">ì‚­ì œ</button>
                `;
                
                itemsDiv.appendChild(div);
            });
        }
        
        function deleteItem(key) {
            if (confirm(`"${key}" í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                localStorage.removeItem(key);
                loadData();
            }
        }
        
        function clearAll() {
            if (confirm('ëª¨ë“  LocalStorage ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.clear();
                loadData();
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        loadData();
    </script>
</body>
</html>
