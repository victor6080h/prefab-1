<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ - ê¸°ìš¸ê¸° ë°ì´í„°</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <h1 class="header-title">Prefab í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p class="header-subtitle">ê¸°ìš¸ê¸° ë°ì´í„° ì¸¡ì • ë° ë¶„ì„</p>
        </div>
    </header>

    <!-- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="page-nav">
        <div class="container">
            <button onclick="window.location.href='index.html'" style="float: right; background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                ğŸ“‹ ë³´ê³ ì„œ ëª©ë¡
            </button>
            <ul>
                <li><a href="report.html">1. ì¢…í•© ìš”ì•½</a></li>
                <li><a href="page2.html">2. ìš´ì†¡ê²°ê³¼ ë¦¬í¬íŠ¸</a></li>
                <li><a href="page3.html">3. ê°€ì†ë„ ë°ì´í„°</a></li>
                <li><a href="page4.html" class="active">4. ê¸°ìš¸ê¸° ë°ì´í„°</a></li>
                <li><a href="page5.html">5. ë³€í˜•ë¥  ë°ì´í„°</a></li>
                <li><a href="page6.html">6. ë¶€ì¬ ì œì‘ ì˜¤ì°¨</a></li>
                <li><a href="dashboard.html">7. ì¢…í•© ëŒ€ì‹œë³´ë“œ</a></li>
            </ul>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container">
        <!-- ì•ˆë‚´ ì‚¬í•­ -->
        <div class="alert alert-info">
            <strong>ğŸ“ ê¸°ìš¸ê¸° ê³„ì¸¡ ì•ˆë‚´</strong>
            <p style="margin-top: 0.5rem;">
                Prefab ë¶€ì¬ì˜ ì„¤ì¹˜ ì‹œ ìˆ˜í‰/ìˆ˜ì§ ê¸°ìš¸ê¸°ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.
            </p>
            <div style="margin-top: 0.75rem; padding: 0.5rem; background-color: white; border-radius: 0.25rem;">
                <strong>í‰ê°€ ê¸°ì¤€:</strong><br>
                <span style="color: #10b981;">âœ“ ì •ìƒ: 3Â° ë¯¸ë§Œ</span> | 
                <span style="color: #f59e0b;">âš  ì£¼ì˜: 3~5Â°</span> | 
                <span style="color: #f97316;">âš ï¸ ê²½ê³ : 5~10Â°</span> | 
                <span style="color: #ef4444;">âŒ ìœ„í—˜: 10Â° ì´ˆê³¼</span>
            </div>
        </div>

        <!-- ê³„ì¸¡ ì •ë³´ ì…ë ¥ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ê³„ì¸¡ ì •ë³´</h2>
            </div>
            <div class="card-body">
                <form id="tiltInfoForm">
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">ì¸¡ì • ë‹¨ê³„ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="tiltPhase" value="ìš´ì†¡ì „" style="width: auto; cursor: pointer;">
                                    <span>ìš´ì†¡ì „</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="tiltPhase" value="ìš´ì†¡ì¤‘" style="width: auto; cursor: pointer;">
                                    <span>ìš´ì†¡ì¤‘</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="tiltPhase" value="ìš´ì†¡í›„" style="width: auto; cursor: pointer;">
                                    <span>ìš´ì†¡í›„</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="tiltPhase" value="ìš´ì†¡ì „-ìš´ì†¡ì¤‘-ìš´ì†¡í›„" style="width: auto; cursor: pointer;">
                                    <span>ìš´ì†¡ì „-ìš´ì†¡ì¤‘-ìš´ì†¡í›„</span>
                                </label>
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label" for="tiltDevice">ì¸¡ì • ì¥ë¹„</label>
                            <select id="tiltDevice" name="tiltDevice" class="info-value" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="JANET PRO 3ì¶• ë””ì§€í„¸ ê°€ì†ë„ê³„ (ê²½ì‚¬ê³„)">JANET PRO 3ì¶• ë””ì§€í„¸ ê°€ì†ë„ê³„ (ê²½ì‚¬ê³„)</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</option>
                            </select>
                            <input type="text" id="tiltDeviceOther" name="tiltDeviceOther" class="info-value" 
                                   placeholder="ì¥ë¹„ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="display: none; margin-top: 0.5rem;">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ (Tilt Report) -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ (Tilt Report)</h2>
                <p class="card-description">ìµœëŒ€ ê¸°ìš¸ê¸° ì¸¡ì •ì¹˜ë¥¼ ì…ë ¥í•˜ê³  í‰ê°€ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
            </div>
            <div class="card-body">
                <!-- ê¸°ìš¸ê¸° ì¸¡ì • ë°ì´í„° ì…ë ¥ -->
                <div class="info-grid" style="margin-bottom: 2rem;">
                    <div class="info-item">
                        <label class="info-label" for="maxTilt">ìµœëŒ€ ê¸°ìš¸ê¸° ì¸¡ì •ì¹˜ (Â°)</label>
                        <input type="number" id="maxTilt" name="maxTilt" step="0.1" class="info-value" 
                               placeholder="ì˜ˆ: 8.5" onchange="saveTiltData()" style="font-size: 1.1rem; font-weight: 600;">
                    </div>
                    <div class="info-item">
                        <label class="info-label" for="avgTilt">í‰ê·  ê¸°ìš¸ê¸° ì¸¡ì •ì¹˜ (Â°)</label>
                        <input type="number" id="avgTilt" name="avgTilt" step="0.1" class="info-value" 
                               placeholder="ì˜ˆ: 5.2" onchange="saveTiltData()" style="font-size: 1.1rem; font-weight: 600;">
                    </div>
                    <div class="info-item">
                        <label class="info-label" for="tiltEventCount">ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜</label>
                        <input type="number" id="tiltEventCount" name="tiltEventCount" step="1" class="info-value" 
                               placeholder="ì˜ˆ: 3" onchange="saveTiltData()" style="font-size: 1.1rem; font-weight: 600;">
                    </div>
                </div>
                
                <!-- ìƒíƒœ í‘œì‹œ -->
                <div id="tiltStatus" style="margin-bottom: 2rem; padding: 0.75rem; border-radius: 0.375rem; font-weight: 600; text-align: center; border: 2px solid transparent; font-size: 1.1rem;"></div>
                
                <!-- ê¸°ìš¸ê¸° í‰ê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                <div>
                    <label class="info-label">ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€</label>
                    <div class="photo-upload-container">
                        <div class="photo-upload" id="tiltReportPreview" onclick="document.getElementById('tiltReportInput').click();" style="cursor: pointer; min-height: 400px;">
                            <input type="file" id="tiltReportInput" accept="image/*" style="display: none;" onchange="handleTiltReportImageUpload(this);">
                            <span class="placeholder">ğŸ“Š í´ë¦­í•˜ì—¬ ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
                        </div>
                    </div>
                    <div class="mt-3" style="text-align: center;">
                        <button class="btn btn-secondary" onclick="clearTiltReportImage()" style="margin-right: 10px;">ğŸ—‘ï¸ ì´ë¯¸ì§€ ì‚­ì œ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„</h2>
                <p class="card-description">ì „ì²´ ê¸°ìš¸ê¸° ë°ì´í„° ê·¸ë˜í”„ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
            </div>
            <div class="card-body">
                <div class="photo-upload-container">
                    <div class="photo-upload" id="tiltGraphPreview" onclick="document.getElementById('tiltGraphInput').click();" style="cursor: pointer;">
                        <input type="file" id="tiltGraphInput" accept="image/*" style="display: none;" onchange="handleTiltGraphImageUpload(this);">
                        <span class="placeholder">ğŸ“Š í´ë¦­í•˜ì—¬ ê·¸ë˜í”„ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
                    </div>
                </div>
                <div class="mt-3" style="text-align: center;">
                    <button class="btn btn-secondary" onclick="clearTiltGraph()" style="margin-right: 10px;">ğŸ—‘ï¸ ì´ë¯¸ì§€ ì‚­ì œ</button>
                </div>
            </div>
        </div>

        <!-- ì¸¡ì • ê²°ê³¼ ìš”ì•½ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ì¸¡ì • ê²°ê³¼ ìš”ì•½</h2>
            </div>
            <div class="card-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ìµœëŒ€ ê¸°ìš¸ê¸°</div>
                        <div class="stat-value" id="maxTiltDisplay">0.0Â°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í‰ê·  ê¸°ìš¸ê¸°</div>
                        <div class="stat-value" id="avgTiltDisplay">0.0Â°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì´ˆê³¼ ì§€ì </div>
                        <div class="stat-value" id="tiltExceedCount">0 ê°œ</div>
                    </div>
                    <div class="stat-card" id="tiltFinalStatus">
                        <div class="stat-label">ì¢…í•© í‰ê°€</div>
                        <div class="stat-value">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>

                <div id="tiltResultAlert" class="mt-3"></div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
        <div class="nav-buttons">
            <a href="page3.html" class="btn btn-secondary">â† ì´ì „: ê°€ì†ë„ ë°ì´í„°</a>
            <button class="btn btn-success" id="saveTiltBtn">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
            <a href="page5.html" class="btn btn-primary">ë‹¤ìŒ: ë³€í˜•ë¥  ë°ì´í„° â†’</a>
        </div>
    </main>

    <!-- Load script.js before inline scripts -->
    <script src="assets/js/script.js"></script>

    <script>
        // ê¸°ìš¸ê¸° ì„ê³„ê°’ (ë„) - 4ë‹¨ê³„ í‰ê°€
        const TILT_NORMAL = 3.0;    // ì •ìƒ
        const TILT_CAUTION = 5.0;   // ì£¼ì˜
        const TILT_WARNING = 10.0;  // ê²½ê³ 
        // 10.0 ì´ˆê³¼ëŠ” ìœ„í—˜

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // ì €ì¥ëœ ë°ì´í„° ë¡œë“œ
            loadTiltData();
            loadTiltReportImage();
            loadTiltGraphImage();
            
            autoSaveForm('tiltInfoForm', STORAGE_KEYS.TILT_DATA);
            
            // ì¸¡ì • ì¥ë¹„ ì„ íƒ ì´ë²¤íŠ¸
            const deviceSelect = document.getElementById('tiltDevice');
            const deviceOtherInput = document.getElementById('tiltDeviceOther');
            
            deviceSelect.addEventListener('change', function() {
                if (this.value === 'ê¸°íƒ€') {
                    deviceOtherInput.style.display = 'block';
                    deviceOtherInput.required = true;
                } else {
                    deviceOtherInput.style.display = 'none';
                    deviceOtherInput.required = false;
                    deviceOtherInput.value = '';
                }
            });
            
            // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById('saveTiltBtn').addEventListener('click', saveTiltData);
            
            console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        });

        // ê¸°ìš¸ê¸° ë°ì´í„° ì €ì¥ ë° ìš”ì•½ ì—…ë°ì´íŠ¸
        function saveTiltData() {
            console.log('ğŸ¯ saveTiltData í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const maxTilt = parseFloat(document.getElementById('maxTilt').value) || 0;
            const avgTilt = parseFloat(document.getElementById('avgTilt').value) || 0;
            const eventCount = parseInt(document.getElementById('tiltEventCount').value) || 0;
            
            console.log('ğŸ“Š ì…ë ¥ê°’:', { maxTilt, avgTilt, eventCount });
            
            // LocalStorageì— ì €ì¥
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA) || {};
            data.maxTilt = maxTilt;
            data.avgTilt = avgTilt;
            data.eventCount = eventCount;
            saveToStorage(STORAGE_KEYS.TILT_DATA, data);
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            console.log('ğŸ”„ updateTiltStatus í˜¸ì¶œ - ê°’:', maxTilt);
            updateTiltStatus(maxTilt);
            
            // ì¸¡ì • ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
            console.log('ğŸ”„ updateTiltSummary í˜¸ì¶œ');
            updateTiltSummary(maxTilt, avgTilt, eventCount);
            
            console.log('ğŸ’¾ ê¸°ìš¸ê¸° ë°ì´í„° ì €ì¥ ì™„ë£Œ:', { maxTilt, avgTilt, eventCount });
        }
        
        // ê¸°ìš¸ê¸° ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateTiltStatus(value) {
            console.log('ğŸ¨ updateTiltStatus í•¨ìˆ˜ ì‹¤í–‰ - ê°’:', value);
            console.log('ğŸ“ ê¸°ì¤€ê°’:', { TILT_NORMAL, TILT_CAUTION, TILT_WARNING });
            
            const statusDiv = document.getElementById('tiltStatus');
            if (!statusDiv) {
                console.error('âŒ tiltStatus ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            if (value > TILT_WARNING) {
                console.log('ğŸ”´ ìœ„í—˜ ë“±ê¸‰ (> 10Â°)');
                statusDiv.style.backgroundColor = '#fee2e2';
                statusDiv.style.borderColor = '#ef4444';
                statusDiv.style.color = '#991b1b';
                statusDiv.innerHTML = 'âŒ ìœ„í—˜: ' + value.toFixed(1) + 'Â° (10Â° ì´ˆê³¼)';
            } else if (value >= TILT_CAUTION) {
                console.log('ğŸŸ  ê²½ê³  ë“±ê¸‰ (5~10Â°)');
                statusDiv.style.backgroundColor = '#fff7ed';
                statusDiv.style.borderColor = '#f97316';
                statusDiv.style.color = '#9a3412';
                statusDiv.innerHTML = 'âš ï¸ ê²½ê³ : ' + value.toFixed(1) + 'Â° (5~10Â°)';
            } else if (value >= TILT_NORMAL) {
                console.log('ğŸŸ¡ ì£¼ì˜ ë“±ê¸‰ (3~5Â°)');
                statusDiv.style.backgroundColor = '#fef3c7';
                statusDiv.style.borderColor = '#f59e0b';
                statusDiv.style.color = '#78350f';
                statusDiv.innerHTML = 'âš  ì£¼ì˜: ' + value.toFixed(1) + 'Â° (3~5Â°)';
            } else if (value > 0) {
                console.log('ğŸŸ¢ ì •ìƒ ë“±ê¸‰ (< 3Â°)');
                statusDiv.style.backgroundColor = '#d1fae5';
                statusDiv.style.borderColor = '#10b981';
                statusDiv.style.color = '#065f46';
                statusDiv.innerHTML = 'âœ… ì •ìƒ: ' + value.toFixed(1) + 'Â° (3Â° ë¯¸ë§Œ)';
            } else {
                statusDiv.style.backgroundColor = '#f3f4f6';
                statusDiv.style.borderColor = '#d1d5db';
                statusDiv.style.color = '#6b7280';
                statusDiv.innerHTML = 'ìµœëŒ€ ê¸°ìš¸ê¸°ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ë“±ê¸‰ì´ í‰ê°€ë©ë‹ˆë‹¤';
            }
            
            console.log('âœ… ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        
        // ì¸¡ì • ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateTiltSummary(maxTilt, avgTilt, eventCount) {
            // ìµœëŒ€ ê¸°ìš¸ê¸° í‘œì‹œ
            document.getElementById('maxTiltDisplay').textContent = maxTilt.toFixed(1) + 'Â°';
            
            // í‰ê·  ê¸°ìš¸ê¸° í‘œì‹œ
            document.getElementById('avgTiltDisplay').textContent = avgTilt.toFixed(1) + 'Â°';
            
            // ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ í‘œì‹œ
            document.getElementById('tiltExceedCount').textContent = eventCount + ' ê°œ';
            
            // ì¢…í•© í‰ê°€
            const finalStatus = document.getElementById('tiltFinalStatus');
            const resultAlert = document.getElementById('tiltResultAlert');
            
            if (maxTilt > TILT_WARNING) {
                finalStatus.className = 'stat-card danger';
                finalStatus.style.backgroundColor = '#fee2e2';
                finalStatus.style.borderColor = '#ef4444';
                finalStatus.style.color = '#991b1b';
                finalStatus.querySelector('.stat-value').textContent = 'ìœ„í—˜';
                resultAlert.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ ìœ„í—˜ ìˆ˜ì¤€</strong><br>
                        ìµœëŒ€ ê¸°ìš¸ê¸°ê°€ ìœ„í—˜ ê¸°ì¤€(10Â°)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                `;
            } else if (maxTilt >= TILT_CAUTION) {
                finalStatus.className = 'stat-card';
                finalStatus.style.backgroundColor = '#fff7ed';
                finalStatus.style.borderColor = '#f97316';
                finalStatus.style.color = '#9a3412';
                finalStatus.querySelector('.stat-value').textContent = 'ê²½ê³ ';
                resultAlert.innerHTML = `
                    <div class="alert" style="background-color: #fff7ed; border: 1px solid #f97316; color: #9a3412; padding: 1rem; border-radius: 0.375rem;">
                        <strong>âš ï¸ ê²½ê³  ìˆ˜ì¤€</strong><br>
                        ìµœëŒ€ ê¸°ìš¸ê¸°ê°€ ê²½ê³  ë²”ìœ„(5~10Â°)ì…ë‹ˆë‹¤. ì£¼ì˜ ê¹Šì€ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                `;
            } else if (maxTilt >= TILT_NORMAL) {
                finalStatus.className = 'stat-card warning';
                finalStatus.style.backgroundColor = '#fef3c7';
                finalStatus.style.borderColor = '#f59e0b';
                finalStatus.style.color = '#78350f';
                finalStatus.querySelector('.stat-value').textContent = 'ì£¼ì˜';
                resultAlert.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>âš  ì£¼ì˜ í•„ìš”</strong><br>
                        ìµœëŒ€ ê¸°ìš¸ê¸°ê°€ ì£¼ì˜ ë²”ìœ„(3~5Â°)ì…ë‹ˆë‹¤. ì§€ì†ì ì¸ ê´€ì°°ì´ ê¶Œì¥ë©ë‹ˆë‹¤.
                    </div>
                `;
            } else if (maxTilt > 0) {
                finalStatus.className = 'stat-card success';
                finalStatus.style.backgroundColor = '#d1fae5';
                finalStatus.style.borderColor = '#10b981';
                finalStatus.style.color = '#065f46';
                finalStatus.querySelector('.stat-value').textContent = 'ì •ìƒ';
                resultAlert.innerHTML = `
                    <div class="alert alert-success">
                        <strong>âœ… ì •ìƒ ë²”ìœ„</strong><br>
                        ìµœëŒ€ ê¸°ìš¸ê¸°ê°€ ì •ìƒ ë²”ìœ„(3Â° ë¯¸ë§Œ)ì…ë‹ˆë‹¤.
                    </div>
                `;
            } else {
                finalStatus.className = 'stat-card';
                finalStatus.style.backgroundColor = '';
                finalStatus.style.borderColor = '';
                finalStatus.style.color = '';
                finalStatus.querySelector('.stat-value').textContent = 'ëŒ€ê¸°ì¤‘';
                resultAlert.innerHTML = '';
            }
        }
        
        // ê¸°ìš¸ê¸° ë°ì´í„° ë¡œë“œ
        function loadTiltData() {
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA);
            
            let maxTilt = 0;
            let avgTilt = 0;
            let eventCount = 0;
            
            if (data) {
                if (data.maxTilt !== undefined) {
                    document.getElementById('maxTilt').value = data.maxTilt;
                    maxTilt = data.maxTilt;
                }
                if (data.avgTilt !== undefined) {
                    document.getElementById('avgTilt').value = data.avgTilt;
                    avgTilt = data.avgTilt;
                }
                if (data.eventCount !== undefined) {
                    document.getElementById('tiltEventCount').value = data.eventCount;
                    eventCount = data.eventCount;
                }
                
                console.log('ğŸ“– ê¸°ìš¸ê¸° ë°ì´í„° ë¡œë“œ:', { maxTilt, avgTilt, eventCount });
            }
            
            // ìƒíƒœ ë° ìš”ì•½ ì—…ë°ì´íŠ¸ (ë°ì´í„° ìˆë“  ì—†ë“  í•­ìƒ ì‹¤í–‰)
            updateTiltStatus(maxTilt);
            updateTiltSummary(maxTilt, avgTilt, eventCount);
        }
        
        // ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ
        function handleTiltReportImageUpload(input) {
            console.log('ğŸ¯ handleTiltReportImageUpload í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const file = input.files[0];
            if (!file) {
                console.log('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            console.log('=== ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì‘ ===');
            console.log('íŒŒì¼ëª…:', file.name);
            console.log('íŒŒì¼ í¬ê¸°:', (file.size / 1024).toFixed(2), 'KB');
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (typeof resizeAndCompressImage === 'undefined') {
                console.error('âŒ resizeAndCompressImage í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                alert('ì´ë¯¸ì§€ ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            resizeAndCompressImage(
                file,
                110,
                0.9,
                function(compressedDataUrl) {
                    console.log('âœ… ì••ì¶• ì„±ê³µ, ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ');
                    
                    const preview = document.getElementById('tiltReportPreview');
                    preview.innerHTML = `
                        <input type="file" id="tiltReportInput" accept="image/*" style="display: none;" onchange="handleTiltReportImageUpload(this)">
                        <img src="${compressedDataUrl}" alt="ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€" style="max-width: 100%; height: auto; display: block;">
                    `;
                    preview.classList.add('has-image');
                    preview.onclick = null;
                    
                    // LocalStorageì— ì €ì¥
                    const data = getFromStorage(STORAGE_KEYS.TILT_DATA) || {};
                    data.tiltReportImage = compressedDataUrl;
                    saveToStorage(STORAGE_KEYS.TILT_DATA, data);
                    
                    console.log('ğŸ’¾ ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ');
                    alert('âœ… ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                },
                function(error) {
                    console.error('âŒ ì´ë¯¸ì§€ ì••ì¶• ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            );
        }
        
        // ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì‚­ì œ
        function clearTiltReportImage() {
            if (!confirm('ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const preview = document.getElementById('tiltReportPreview');
            preview.innerHTML = `
                <input type="file" id="tiltReportInput" accept="image/*" style="display: none;" onchange="handleTiltReportImageUpload(this);">
                <span class="placeholder">ğŸ“Š í´ë¦­í•˜ì—¬ ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
            `;
            preview.classList.remove('has-image');
            preview.onclick = function() { document.getElementById('tiltReportInput').click(); };
            
            // LocalStorageì—ì„œ ì‚­ì œ
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA) || {};
            delete data.tiltReportImage;
            saveToStorage(STORAGE_KEYS.TILT_DATA, data);
            
            console.log('ğŸ—‘ï¸ ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì‚­ì œë¨');
            alert('ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ë¡œë“œ
        function loadTiltReportImage() {
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA);
            if (data && data.tiltReportImage) {
                const preview = document.getElementById('tiltReportPreview');
                preview.innerHTML = `
                    <input type="file" id="tiltReportInput" accept="image/*" style="display: none;" onchange="handleTiltReportImageUpload(this)">
                    <img src="${data.tiltReportImage}" alt="ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€" style="max-width: 100%; height: auto; display: block;">
                `;
                preview.classList.add('has-image');
                preview.onclick = null;
                console.log('ğŸ“– ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ë¡œë“œë¨');
            }
        }
        
        // ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleTiltGraphImageUpload(input) {
            console.log('ğŸ¯ handleTiltGraphImageUpload í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const file = input.files[0];
            if (!file) {
                console.log('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            console.log('=== ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì‘ ===');
            console.log('íŒŒì¼ëª…:', file.name);
            console.log('íŒŒì¼ í¬ê¸°:', (file.size / 1024).toFixed(2), 'KB');
            
            // ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // resizeAndCompressImage í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
            if (typeof resizeAndCompressImage === 'undefined') {
                console.error('âŒ resizeAndCompressImage í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                alert('ì´ë¯¸ì§€ ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('âœ… resizeAndCompressImage í•¨ìˆ˜ ì°¾ìŒ, ì••ì¶• ì‹œì‘');
            
            // ì´ë¯¸ì§€ ì••ì¶• ë° ì €ì¥
            resizeAndCompressImage(
                file,
                110, // ëª©í‘œ í¬ê¸° (KB)
                0.9, // ì´ˆê¸° í’ˆì§ˆ
                function(compressedDataUrl) {
                    console.log('âœ… ì••ì¶• ì„±ê³µ, ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ');
                    
                    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                    const preview = document.getElementById('tiltGraphPreview');
                    preview.innerHTML = `
                        <input type="file" id="tiltGraphInput" accept="image/*" style="display: none;" onchange="handleTiltGraphImageUpload(this)">
                        <img src="${compressedDataUrl}" alt="ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„" style="max-width: 100%; height: auto; display: block;">
                    `;
                    preview.classList.add('has-image');
                    preview.onclick = null; // ì´ë¯¸ì§€ê°€ í‘œì‹œë˜ë©´ í´ë¦­ ì´ë²¤íŠ¸ ì œê±°
                    
                    // LocalStorageì— ì €ì¥
                    saveToStorage(STORAGE_KEYS.TILT_GRAPH_IMAGE, compressedDataUrl);
                    
                    console.log('ğŸ’¾ ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ');
                    alert('âœ… ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                },
                function(error) {
                    console.error('âŒ ì´ë¯¸ì§€ ì••ì¶• ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            );
        }

        // ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ë¡œë“œ
        function loadTiltGraphImage() {
            console.log('ğŸ“‚ ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„');
            const imageData = getFromStorage(STORAGE_KEYS.TILT_GRAPH_IMAGE);
            
            if (imageData) {
                console.log('âœ… ì €ì¥ëœ ì´ë¯¸ì§€ ë°œê²¬');
                const preview = document.getElementById('tiltGraphPreview');
                if (preview) {
                    preview.innerHTML = `
                        <input type="file" id="tiltGraphInput" accept="image/*" style="display: none;" onchange="handleTiltGraphImageUpload(this)">
                        <img src="${imageData}" alt="ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„" style="max-width: 100%; height: auto; display: block;">
                    `;
                    preview.classList.add('has-image');
                    preview.onclick = null; // ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ í´ë¦­ ì´ë²¤íŠ¸ ì œê±°
                    console.log('âœ… ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ í‘œì‹œ ì™„ë£Œ');
                } else {
                    console.error('âŒ tiltGraphPreview ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } else {
                console.log('â„¹ï¸ ì €ì¥ëœ ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì—†ìŒ');
            }
        }

        // ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì‚­ì œ
        function clearTiltGraph() {
            if (!confirm('ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            console.log('ğŸ—‘ï¸ ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì‚­ì œ ì‹œì‘');
            
            const preview = document.getElementById('tiltGraphPreview');
            preview.innerHTML = `
                <input type="file" id="tiltGraphInput" accept="image/*" style="display: none;" onchange="handleTiltGraphImageUpload(this)">
                <span class="placeholder">ğŸ“Š í´ë¦­í•˜ì—¬ ê·¸ë˜í”„ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
            `;
            preview.classList.remove('has-image');
            preview.onclick = function() { document.getElementById('tiltGraphInput').click(); };
            
            // LocalStorageì—ì„œ ì‚­ì œ
            localStorage.removeItem(getStorageKey('TILT_GRAPH_IMAGE'));
            
            console.log('âœ… ì „ì²´ ê¸°ìš¸ê¸° ê·¸ë˜í”„ ì´ë¯¸ì§€ ì‚­ì œ ì™„ë£Œ');
            alert('âœ… ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    </script>
</body>
</html>
