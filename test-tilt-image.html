<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .success { background: #10b981; color: white; }
        .info { background: #3b82f6; color: white; }
        .danger { background: #ef4444; color: white; }
        pre {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        img {
            max-width: 100%;
            border: 1px solid #ddd;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€ ì´ë¯¸ì§€ ì €ì¥/ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>

    <div class="section">
        <h2>1. í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì €ì¥</h2>
        <button class="success" onclick="saveTestTiltImage()">ğŸ’¾ í…ŒìŠ¤íŠ¸ ê¸°ìš¸ê¸° ì´ë¯¸ì§€ ì €ì¥</button>
        <p id="saveResult"></p>
    </div>

    <div class="section">
        <h2>2. ì €ì¥ëœ ë°ì´í„° í™•ì¸</h2>
        <button class="info" onclick="checkTiltData()">ğŸ” LocalStorage ë°ì´í„° í™•ì¸</button>
        <div id="dataResult"></div>
    </div>

    <div class="section">
        <h2>3. ì´ë¯¸ì§€ í‘œì‹œ í…ŒìŠ¤íŠ¸</h2>
        <button class="info" onclick="displayTiltImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ í‘œì‹œ</button>
        <div id="imageDisplay"></div>
    </div>

    <div class="section">
        <h2>4. ë°ì´í„° ì‚­ì œ</h2>
        <button class="danger" onclick="clearTiltData()">ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ</button>
    </div>

    <script>
        const STORAGE_KEYS = {
            TILT_DATA: 'qms_tilt_data'
        };

        function getFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('ì €ì¥ì†Œ ì½ê¸° ì˜¤ë¥˜:', e);
                return null;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('ì €ì¥ì†Œ ì“°ê¸° ì˜¤ë¥˜:', e);
                return false;
            }
        }

        function saveTestTiltImage() {
            // 1x1 ë¹¨ê°„ìƒ‰ PNG ì´ë¯¸ì§€ (Base64)
            const testImageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFUlEQVR42mP8z8BQz0AEYBxVSF+FABJADveWkH6oAAAAAElFTkSuQmCC';
            
            const tiltData = {
                maxTilt: 8.5,
                avgTilt: 5.2,
                eventCount: 3,
                tiltReportImage: testImageData,
                timestamp: new Date().toISOString()
            };
            
            const result = saveToStorage(STORAGE_KEYS.TILT_DATA, tiltData);
            
            if (result) {
                document.getElementById('saveResult').innerHTML = `
                    <p style="color: green;">âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì™„ë£Œ!</p>
                    <p>ìµœëŒ€ ê¸°ìš¸ê¸°: ${tiltData.maxTilt}Â°</p>
                    <p>í‰ê·  ê¸°ìš¸ê¸°: ${tiltData.avgTilt}Â°</p>
                    <p>ì´ë²¤íŠ¸ íšŸìˆ˜: ${tiltData.eventCount}íšŒ</p>
                    <p>ì´ë¯¸ì§€ í¬ê¸°: ${testImageData.length} bytes</p>
                `;
            } else {
                document.getElementById('saveResult').innerHTML = '<p style="color: red;">âŒ ì €ì¥ ì‹¤íŒ¨</p>';
            }
        }

        function checkTiltData() {
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA);
            
            if (data) {
                let html = '<h3 style="color: green;">âœ… ë°ì´í„° ì¡´ì¬</h3>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                if (data.tiltReportImage) {
                    html += '<p style="color: green;"><strong>âœ… tiltReportImage ì†ì„± ì¡´ì¬</strong></p>';
                    html += '<p>ì´ë¯¸ì§€ ë°ì´í„° í¬ê¸°: ' + data.tiltReportImage.length + ' bytes</p>';
                    html += '<p>ì´ë¯¸ì§€ íƒ€ì…: ' + data.tiltReportImage.substring(0, 30) + '...</p>';
                } else {
                    html += '<p style="color: red;"><strong>âŒ tiltReportImage ì†ì„± ì—†ìŒ</strong></p>';
                }
                
                document.getElementById('dataResult').innerHTML = html;
            } else {
                document.getElementById('dataResult').innerHTML = '<p style="color: red;">âŒ ì €ì¥ëœ ë°ì´í„° ì—†ìŒ</p>';
            }
        }

        function displayTiltImage() {
            const data = getFromStorage(STORAGE_KEYS.TILT_DATA);
            
            if (data && data.tiltReportImage) {
                document.getElementById('imageDisplay').innerHTML = `
                    <p style="color: green;">âœ… ì´ë¯¸ì§€ í‘œì‹œ ì„±ê³µ</p>
                    <img src="${data.tiltReportImage}" alt="ê¸°ìš¸ê¸° ë“±ê¸‰ í‰ê°€" style="max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                `;
            } else {
                document.getElementById('imageDisplay').innerHTML = '<p style="color: red;">âŒ ì´ë¯¸ì§€ ë°ì´í„° ì—†ìŒ</p>';
            }
        }

        function clearTiltData() {
            if (confirm('ì •ë§ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem(STORAGE_KEYS.TILT_DATA);
                alert('âœ… ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('saveResult').innerHTML = '';
                document.getElementById('dataResult').innerHTML = '';
                document.getElementById('imageDisplay').innerHTML = '';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° í™•ì¸
        window.addEventListener('DOMContentLoaded', function() {
            checkTiltData();
        });
    </script>
</body>
</html>
